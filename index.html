<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Calculateur APR & Arbitrage Toutes Paires Hyperliquid/Aster</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        table { border-collapse: collapse; width: 100%; font-size: 12px; }
        th, td { border: 1px solid #ddd; padding: 6px; text-align: right; }
        th:first-child, td:first-child { text-align: left; }
        input, select, button { margin: 5px; }
        #filter { width: 150px; }
        .positive { color: green; } .negative { color: red; }
        .arb-highlight { background: yellow; }
    </style>
</head>
<body>
    <h2>Toutes Paires : APR Net & Arbitrage Long/Short Aster vs Hyperliquid</h2>
    <label>Position Size (USDC): <input type="number" id="size" value="10000"></label>
    <label>Levier: <input type="number" id="levier" value="10"></label>
    <label>Side: <select id="side"><option value="long">Long</option><option value="short">Short</option></select></label>
    <label>Filtrer: <input type="text" id="filter" placeholder="Ex. BTC, ETH" onkeyup="updateTable()"></label>
    <button onclick="updateTable()">Trier par APR</button>
    <button onclick="highlightArbitrage()">Montrer Arbitrages >5%</button>
    <table id="fundingTable">
        <thead><tr><th>Paire</th><th>Exchange</th><th>Funding Rate (%/période)</th><th>Spread (%)</th><th>APR Net Annuel (%)</th><th>Arbitrage vs Autre (Long/Short %)</th></tr></thead>
        <tbody></tbody>
    </table>
    <canvas id="aprChart" width="600" height="300"></canvas>

    <script>
        // Liste complète Hyperliquid (184 paires, majors + alts basés sur 2025 data)
        const hyperPairs = ['BTC', 'ETH', 'SOL', 'AVAX', 'LINK', 'BNB', 'XRP', 'ADA', 'DOGE', 'MATIC', 'DOT', 'TRX', 'SHIB', 'LTC', 'BCH', 'ATOM', 'XLM', 'ALGO', 'NEAR', 'VET', 'HBAR', 'FTM', 'SAND', 'MANA', 'GALA', 'UNI', 'AAVE', 'FIL', 'ICP', 'APT', 'ARB', 'OP', 'INJ', 'SUI', 'SEI', 'TIA', 'WLD', 'ZRO', 'JUP', 'PYTH', 'JTO', 'WIF', 'BONK', 'POPCAT', 'MEW', 'BOME', 'MOG', 'PEPE', 'FLOKI', 'BRETT', 'GME', 'DEGEN', 'TURBO', 'SPX', 'ACT', 'ZKS', 'ZK', 'STRK', 'OM', 'GLM', 'WCT', 'CORE', 'KAIA', 'HYPE', 'FRIEND-USD', 'HPOS']; // Étendu à 60+ ; génère le reste dynamiquement
        const asterPairs = ['BTC', 'ETH', 'SOL', 'DOGE', 'ADA', 'BNB', 'XRP', 'MATIC', 'DOT', 'TRX', 'SHIB', 'LTC', 'BCH', 'ATOM', 'XLM', 'ALGO', 'NEAR', 'VET', 'HBAR', 'FTM', 'SAND', 'MANA', 'GALA', 'AAVE', 'UNI', 'FIL', 'ICP', 'APT', 'ARB', 'OP', 'INJ', 'SUI', 'SEI', 'TIA', 'WLD', 'ZRO', 'JUP', 'PYTH', 'JTO', 'WIF', 'BONK', 'PEPE', 'FLOKI', 'BRETT']; // 40+ communes

        // Génère toutes les 184 Hyper + Aster (simulé réaliste 30/09/2025)
        function generateAllData() {
            const allData = [];
            // Hyperliquid : 184 paires, funding 0.0000125-0.0000417 (0.0125-0.0417%)
            hyperPairs.forEach((pair, i) => {
                const funding = 0.0000125 + (i * 0.000001); // Croissant pour alts
                const spread = 0.005 + (i * 0.0001);
                allData.push({ pair, exchange: 'Hyperliquid', funding: funding * 100, spread, period: 1 });
            });
            // Étendre à 184 : Ajoute alts fictifs
            for (let i = hyperPairs.length; i < 184; i++) {
                const pair = `ALT${i}`;
                const funding = 0.00002 + (Math.random() * 0.00002);
                const spread = 0.01 + (Math.random() * 0.02);
                allData.push({ pair, exchange: 'Hyperliquid', funding: funding * 100, spread, period: 1 });
            }
            // Aster : 40+ paires, funding 0.01-0.015%/8h
            asterPairs.forEach((pair, i) => {
                const funding = 0.0100 + (i * 0.0005);
                const spread = 0.020 + (i * 0.001);
                allData.push({ pair, exchange: 'Aster', funding, spread, period: 8 });
            });
            // Ajoute 60 alts Aster
            for (let i = asterPairs.length; i < 100; i++) {
                const pair = `AST${i}`;
                const funding = 0.008 + (Math.random() * 0.007);
                const spread = 0.015 + (Math.random() * 0.015);
                allData.push({ pair, exchange: 'Aster', funding, spread, period: 8 });
            }
            return allData;
        }

        let allData = generateAllData(); // Toutes les ~284 entrées
        const arbCache = {}; // Cache arbitrage par paire

        function calculateAPR(fundingRate, size, levier, side, spread, periodHours) {
            const value = size * levier;
            const sign = (side === 'long' && fundingRate > 0) || (side === 'short' && fundingRate < 0) ? 1 : -1;
            const netPerFunding = sign * (fundingRate / 100) * value - (spread / 100 * value);
            const annual = (netPerFunding * (8760 / periodHours)) / size;
            return annual;
        }

        function calculateArbitrage(pair, size, levier) {
            if (arbCache[pair]) return arbCache[pair];
            const hyper = allData.find(d => d.pair === pair && d.exchange === 'Hyperliquid');
            const aster = allData.find(d => d.pair === pair && d.exchange === 'Aster');
            if (!hyper || !aster) return 0;
            const aprLongAster = calculateAPR(aster.funding, size, levier, 'long', aster.spread, aster.period);
            const aprShortHyper = calculateAPR(hyper.funding, size, levier, 'short', hyper.spread, hyper.period);
            const arb = aprLongAster - aprShortHyper; // Arbitrage positif : long Aster / short Hyper
            arbCache[pair] = arb.toFixed(2);
            return arb;
        }

        function updateTable() {
            const size = parseFloat(document.getElementById('size').value);
            const levier = parseFloat(document.getElementById('levier').value);
            const side = document.getElementById('side').value;
            const filter = document.getElementById('filter').value.toLowerCase();

            let filteredData = allData.filter(d => d.pair.toLowerCase().includes(filter));
            filteredData = filteredData.map(row => {
                const apr = calculateAPR(row.funding, size, levier, side, row.spread, row.period);
                const arb = (row.exchange === 'Aster' || row.exchange === 'Hyperliquid') ? calculateArbitrage(row.pair, size, levier) : 0;
                return { ...row, apr: apr.toFixed(2), arb: arb.toFixed(2) };
            }).sort((a, b) => parseFloat(b.apr) - parseFloat(a.apr)); // Trier par APR desc

            let tableBody = '';
            const labels = [], aprs = [];
            filteredData.slice(0, 100).forEach(row => { // Limite à 100 pour perf
                const arbClass = Math.abs(parseFloat(row.arb)) > 5 ? 'arb-highlight' : '';
                tableBody += `<tr class="${arbClass}"><td>${row.pair}</td><td>${row.exchange}</td><td>${row.funding.toFixed(4)} (/${row.period}h)</td><td>${row.spread.toFixed(4)}</td><td class="${parseFloat(row.apr) > 0 ? 'positive' : 'negative'}">${row.apr}</td><td>${row.arb} (Long ${row.exchange === 'Aster' ? 'Aster' : 'Hyper'} / Short Autre)</td></tr>`;
                labels.push(row.pair);
                aprs.push(parseFloat(row.apr));
            });
            document.querySelector('#fundingTable tbody').innerHTML = tableBody;

            // Chart
            const ctx = document.getElementById('aprChart').getContext('2d');
            if (window.myChart) window.myChart.destroy();
            window.myChart = new Chart(ctx, {
                type: 'bar',
                data: { labels: labels.slice(0, 20), datasets: [{ label: 'APR Net (%)', data: aprs.slice(0, 20), backgroundColor: aprs.map(a => a > 0 ? 'green' : 'red') }] },
                options: { scales: { y: { beginAtZero: true } } }
            });
        }

        function highlightArbitrage() {
            // Ajoute classe pour |arb| >5%
            const rows = document.querySelectorAll('#fundingTable tbody tr');
            rows.forEach(row => {
                const arb = parseFloat(row.cells[5].textContent.split(' ')[0]);
                row.classList.toggle('arb-highlight', Math.abs(arb) > 5);
            });
        }

        updateTable(); // Load initial
    </script>
</body>
</html>
